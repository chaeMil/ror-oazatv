<%= simple_form_for @archive_item,
                    url: (@archive_item.new_record? ? admin_archive_items_path : admin_archive_item_path(id: @archive_item.id)),
                    method: (@archive_item.new_record? ? :post : :put) do |form| %>
  <% if @archive_item.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@archive_item.errors.count, "error") %> prohibited this archive_item from being saved:</h2>

      <ul>
        <% @archive_item.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= render 'admin/shared/forms/localized_text_field', model: @archive_item, name: 'title' %>

  <%= render 'admin/shared/forms/localized_editor', model: @archive_item, name: 'description', horizontal: true %>

  <p>
    <%= form.label :published %> <br>
    <%= form.check_box :published %>
  </p>

  <p>
    <%= form.label :date %> <br>
    <%= form.text_field :date %>
  </p>

  <p>
    <%= form.label :categories %>
    <%= form.text_field :categories, value: (@archive_item.categories.map do |category| category.id end.join(',')) %>
    <br>
    <% @categories.each do |category| %>
      <a href="#" class="add-category" data-category-id="<%= category['id'] %>"><%= category['title'] %></a>
    <% end %>
  </p>

  <p>
    <%= form.label :tags %>
    <%= form.text_area :tags %>
  </p>

  <p>
    <%= form.label :note %>
    <%= form.text_area :note %>
  </p>

  <div class="actions">
    <%= form.submit %>
  </div>
<% end %>

<% content_for :scripts do %>
  <script type="text/javascript" charset="utf-8">
    var input = $('#archive_item_categories');
    input.tagsinput({
        confirmKeys: [13, 44],
        itemValue: 'id',
        itemText: 'text',
    });

    input.on('itemRemoved', function(e) {
        $('[data-category-id="' + e.item.id + '"]').removeClass('d-none');
    });

    <% @archive_item.categories.each do |category| %>
      input.tagsinput('add', { id: <%= category['id'] %>, text: '<%= category['title'] %>'});
      $('[data-category-id="<%= category['id'] %>"]').addClass('d-none');
    <% end %>

    $('.add-category').click(function(e) {
        e.preventDefault();
        $(this).addClass('d-none');
        input.tagsinput('add', { id: $(this).attr('data-category-id'), text: $(this).text()});
    })
  </script>
<% end %>